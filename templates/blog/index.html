{% load staticfiles %}
<html>
<head>
    <link href='//fonts.googleapis.com/css?family=Lobster|Raleway:400,00,600' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="{% static "css/normalize.css" %}">
    <link rel="stylesheet" href="{% static "css/skeleton.css" %}">
    <link rel="stylesheet" href="{% static "css/custom.css" %}">
    <link rel="stylesheet" href="{% static "css/chat-bubble.css" %}">
    <title>Casal Que Corre</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Um diÃ¡rio com os treinos e eventos de corrida que o casal Israel & Bianca participam."/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="{% static "js/lib/browser.min.js" %}" charset="utf-8"></script>
    <script type="text/babel">
        "use strict"

        $(function(){
            $.ajax({
                type:'GET',
                url: 'relatos/',
                success:parseArquivoDeRelatos
            })
        })

        function parseArquivoDeRelatos(arquivo){
            var tokens, data, titulo, relatoBianca, relatoIsrael, imagem;
            var contador = 0

            for(let linha of arquivo.split('\n')){
                if(linha.startsWith('-') || linha.trim() == '')
                    continue;
                contador++
                if(contador == 1) {
                    tokens = linha.split(' - ')
                    data = tokens[0]
                    titulo = tokens[1]
                    imagem = titulo.substring(titulo.indexOf('{') + 1, titulo.indexOf('}'))
                    titulo = titulo.substring(0, titulo.indexOf('{'))
                }
                else if(contador == 2)
                    relatoBianca = linha
                else if(contador == 3) {
                    relatoIsrael = linha
                    contador = 0
                    $('#timeline').append(gerarHtmlDoRelato(data, titulo, relatoBianca, relatoIsrael, imagem))
                }
            }
        }

        function gerarHtmlDoRelato(data, titulo, bianca, israel, imagem){
            let relato = `
                <div style="margin-top: 20px;">
                    <div>
                        <h5>
                            <div style="background-color: #fff; border-radius: 10px; padding: 10px; width: 300px; margin: auto">
                                <strong>${data}</strong><br>${titulo}
                            </div>
                        </h5>
                    </div>
                    <div>
                        <div style="float: left; width: 100px">
                            <img src="{% static "img/bianca_avatar.png" %}" class="avatar-frame">
                        </div>
                        <p class="chat-bubble left" style="margin-left: 130px">
                            ${bianca}
                        </p>
                    </div>
                    <div>
                        <div style="float: right; width: 100px">
                            <img src="{% static "img/israel_avatar.png" %}" class="avatar-frame">
                        </div>
                        <p class="chat-bubble right" style="margin-right: 130px">
                            ${israel}
                        </p>
                     </div>
                     <div>
                         <img src="{% static "img" %}/${imagem}" class="imagem">
                     </div>
                </div>
                `;
            return relato;
        }

    </script>
</head>
<body class="background">
<div class="logo">
    <div class="titulo">Casal Que Corre</div>
    <div class="subtitulo">&quot;Nas retas e nas subidas, at&eacute; que a morte os separe.&quot;</div>
</div>
<div id="timeline" class="container"></div>
<div class="footer">
    Um projeto feito com carinho, por um casal que n&atilde;o fica mais parado.
</div>
</body>
</html>
